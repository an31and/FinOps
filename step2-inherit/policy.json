{
  "properties": {
    "displayName": "Cost_Center: Inherit from Resource Group",
    "policyType": "Custom",
    "mode": "Indexed",
    "description": "Step 2: Inherits Cost_Center from parent resource group when resource has no Cost_Center tag",
    "metadata": {
      "category": "Tags",
      "version": "1.0.0",
      "author": "Anand Lakhera (anand.lakhera@ahead.com)",
      "deploymentOrder": 2,
      "relatedPolicies": [
        "cost-center-normalize-v3",
        "cost-center-cleanup-v3",
        "deny-rg-without-cost-center"
      ]
    },
    "version": "1.0.0",
    "policyRule": {
      "if": {
        "allOf": [
          {
            "field": "type",
            "notIn": [
              "Microsoft.Resources/subscriptions/resourceGroups"
            ]
          },
          {
            "field": "tags['Cost_Center']",
            "exists": false
          },
          {
            "field": "tags['Cost-Center']",
            "exists": false
          },
          {
            "field": "tags['CostCenter']",
            "exists": false
          },
          {
            "field": "tags['Cost Centre']",
            "exists": false
          },
          {
            "field": "tags['costcentre']",
            "exists": false
          },
          {
            "field": "tags['Cost-Centre']",
            "exists": false
          },
          {
            "field": "tags['Cost Center']",
            "exists": false
          },
          {
            "field": "tags['Cost_ Center']",
            "exists": false
          },
          {
            "field": "tags['cost-center']",
            "exists": false
          },
          {
            "value": "[resourceGroup().tags['Cost_Center']]",
            "notEquals": ""
          }
        ]
      },
      "then": {
        "effect": "modify",
        "details": {
          "roleDefinitionIds": [
            "/providers/Microsoft.Authorization/roleDefinitions/4a9ae827-6dc8-4573-8ac7-8239d42aa03f"
          ],
          "operations": [
            {
              "field": "tags['Cost_Center']",
              "operation": "addOrReplace",
              "value": "[resourceGroup().tags['Cost_Center']]"
            }
          ]
        }
      }
    }
  },
  "id": "/subscriptions/{subscription-id}/providers/Microsoft.Authorization/policyDefinitions/cost-center-inherit-rg-v3",
  "type": "Microsoft.Authorization/policyDefinitions",
  "name": "cost-center-inherit-rg-v3"
}
